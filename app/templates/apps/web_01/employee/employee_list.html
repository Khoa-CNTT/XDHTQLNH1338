{% extends '/base/base.html' %}
{% import "/apps/web_01/commom/macros.html" as macros %}
{% block body %}
<div class="col-lg-12">

    <!-- Card table list-->
    <div id='data-table-list'>
        <div class="card">
            <div class="card-header">
                <h4 class="card-title">Qu·∫£n l√Ω nh√¢n vi√™n</h4>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-responsive-md" id='table_data'>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Nh√¢n vi√™n</th>
                                <th>L∆∞∆°ng c∆° b·∫£n</th>
                                <th>T·ªïng ca l√†m</th>
                                <th>T·ªïng gi·ªù l√†m</th>
                                <th>L∆∞∆°ng th·ª±c t·∫ø</th>
                                <th>Tr·∫°ng th√°i & Lo·∫°i Ca</th>
                                <th>Ng√†y t·∫°o</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

</div>

{% endblock %}

{% block script %}
<script type="text/javascript">
    $(document).ready(function () {
        var table = $('#table_data').DataTable({
            ...DATATABLE_CONFIG,
            processing: true,
            serverSide: true,
            autoWidth: false,
            responsive: true,
            ajax: {
                url: "{{ url('web_01:employee_list') }}",
                type: "POST",
                headers: { 'X-CSRFToken': '{{ csrf_token }}' },
                beforeSend: function () {
                    disable_element($('#table_data'));
                },
                complete: function () {
                    enable_element($('#table_data'));
                },
                error: function(xhr, status, error) {
                    console.error("L·ªói t·∫£i d·ªØ li·ªáu nh√¢n vi√™n:", error);
                }
            },
            columns: [
                { data: "index", title: "#" },

                { 
                    data: "username", title: "Nh√¢n vi√™n",
                    render: function(data, type, row) {
                        const username = row.username || "N/A";
                        return `<i class="fa-solid fa-user-tie"></i> ${username}`;
                    }
                },

                { 
                    data: "salary", title: "L∆∞∆°ng c∆° b·∫£n",
                    render: function(data) {
                        return `<span class="badge badge-info">${data}</span>`;
                    }
                },

                { 
                    data: "total_shifts", title: "T·ªïng ca l√†m",
                    render: function(data) {
                        return `<span class="badge badge-primary">${data}</span>`;
                    }
                },

                { 
                    data: "total_hours", title: "T·ªïng gi·ªù l√†m",
                    render: function(data) {
                        return `<span class="badge badge-warning">${data}</span>`;
                    }
                },

                { 
                    data: "calculated_salary", title: "L∆∞∆°ng th·ª±c t·∫ø",
                    render: function(data) {
                        return `<span class="badge badge-success">${data}</span>`;
                    }
                },

                { 
                    data: null, title: "Tr·∫°ng th√°i & Lo·∫°i Ca",
                    className: "text-center",  // ‚úÖ CƒÉn gi·ªØa n·ªôi dung trong DataTables
                    render: function(data, type, row) {
                        let shiftTypeLabel = "";
                        if (row.shift_type === "morning") {
                            shiftTypeLabel = "‚òÄÔ∏è S√°ng";
                        } else if (row.shift_type === "afternoon") {
                            shiftTypeLabel = "üåû Chi·ªÅu";
                        } else if (row.shift_type === "evening") {
                            shiftTypeLabel = "üåô T·ªëi";
                        } else {
                            shiftTypeLabel = "‚ùì Kh√¥ng r√µ";
                        }
                
                        let statusLabel = "";
                        if (row.status === "worked") {
                            statusLabel = `<span class="badge badge-success d-block text-center">‚úÖ ƒê√£ l√†m</span>`;
                        } else if (row.status === "off") {
                            statusLabel = `<span class="badge badge-danger d-block text-center">‚ùå Ngh·ªâ</span>`;
                        } else {
                            statusLabel = `<span class="badge badge-secondary d-block text-center">‚ö™ Kh√¥ng x√°c ƒë·ªãnh</span>`;
                        }
                
                        return `<div class="text-center">${statusLabel} <br> <span class="badge badge-dark">${shiftTypeLabel}</span></div>`;
                    }
                },

                { 
                    data: "created_at", title: "Ng√†y t·∫°o",
                    render: function(data) {
                        return `<i class="fa fa-calendar"></i> ${data}`;
                    }
                },

                { 
                    data: "id", title: "Thao t√°c",
                    render: function(data, type, row) {
                        return `
                            <button type='button' class="btn btn-light btn-primary shadow btn-xs sharp me-1 edit-employee" 
                            data-id="${row.id}" data-bs-toggle="modal" data-bs-target="#modalEditEmployee">
                                <i class="fa fa-pencil"></i>
                            </button>

                            <button type='button' class="btn btn-light btn-danger shadow btn-xs sharp me-1 delete-employee" 
                            data-id="${row.id}">
                                <i class="fa fa-trash"></i>
                            </button>
                        `;
                    }
                }
            ]
        });
    });
</script>
{% endblock %}
